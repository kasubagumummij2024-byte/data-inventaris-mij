<%- include('partials/header') %>

<h1 class="h2 mb-4">Edit Barang: <span class="text-primary"><%= item.namaBarang %></span></h1>

<div class="bg-white p-4 rounded shadow-sm">
    <form action="/update/<%= item.id %>" method="POST">
        <div class="mb-3">
            <label for="nomorInventaris" class="form-label">Nomor Inventaris</label>
            <input type="text" class="form-control" id="nomorInventaris" name="nomorInventaris" value="<%= item.nomorInventaris %>" readonly disabled>
        </div>

        <div class="row">
            <div class="col-md-8 mb-3">
                <label for="namaBarang" class="form-label">Nama Barang</label>
                <input type="text" class="form-control" id="namaBarang" name="namaBarang" value="<%= item.namaBarang %>" required>
            </div>
            <div class="col-md-4 mb-3">
                <label for="warna" class="form-label">Warna</label>
                <select class="form-select" id="warna" name="warna" required>
                    <% options.warna.forEach(w => { %>
                        <option value="<%= w %>" <%= item.warna === w ? 'selected' : '' %>><%= w %></option>
                    <% }) %>
                </select>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6 mb-3">
                <label for="kategori" class="form-label">Kategori</label>
                 <!-- DIUBAH: data-master sekarang pakai dataMasterLengkap -->
                <select class="form-select" id="kategori" name="kategori" data-master="<%= JSON.stringify(dataMasterLengkap) %>" required>
                    <option value="" disabled>-- Pilih Kategori --</option>
                    <% Object.keys(dataMasterLengkap).forEach(k => { %>
                        <option value="<%= k %>" <%= item.kategori === k ? 'selected' : '' %>><%= k %></option>
                    <% }) %>
                </select>
            </div>
            <div class="col-md-6 mb-3">
                <label for="subKategori" class="form-label">Sub Kategori</label>
                <select class="form-select" id="subKategori" name="subKategori" required>
                    <!-- Script main.js akan mengisi opsi, kita set value awalnya di sini -->
                    <option value="<%= item.subKategori %>" selected><%= item.subKategori %></option>
                </select>
            </div>
        </div>

        <div class="row">
             <div class="col-md-8 mb-3">
                <label for="sumberAnggaran" class="form-label">Sumber Anggaran</label>
                <select class="form-select" id="sumberAnggaran" name="sumberAnggaran" required>
                    <% options.sumberAnggaran.forEach(sa => { %>
                        <option value="<%= sa %>" <%= item.sumberAnggaran === sa ? 'selected' : '' %>><%= sa %></option>
                    <% }) %>
                </select>
            </div>
             <div class="col-md-4 mb-3">
                <label for="tahunPerolehan" class="form-label">Tahun Perolehan</label>
                <input type="number" class="form-control" id="tahunPerolehan" name="tahunPerolehan" value="<%= item.tahunPerolehan %>" placeholder="Contoh: 2024" min="1900" max="<%= new Date().getFullYear() %>" required>
            </div>
        </div>


        <div class="row">
            <div class="col-md-4 mb-3">
                <label for="jumlah" class="form-label">Jumlah Terkini</label>
                <input type="number" class="form-control" id="jumlah" name="jumlah" value="<%= item.jumlah %>" min="0" required>
                 <small class="form-text text-muted">Jumlah awal: <%= item.jumlah_awal %></small>
            </div>
            <div class="col-md-4 mb-3">
                <label for="satuan" class="form-label">Satuan</label>
                <select class="form-select" id="satuan" name="satuan" required>
                    <% options.satuan.forEach(s => { %>
                        <option value="<%= s %>" <%= item.satuan === s ? 'selected' : '' %>><%= s %></option>
                    <% }) %>
                </select>
            </div>
            <div class="col-md-4 mb-3">
                 <label for="nilaiPerolehan" class="form-label">Nilai Perolehan (Rp)</label>
                <input type="number" class="form-control" id="nilaiPerolehan" name="nilaiPerolehan" value="<%= item.nilaiPerolehan %>" step="1" min="0" required>
            </div>
        </div>

        <div class="row">
            <div class="col-md-8 mb-3">
                <label for="lokasiFisik" class="form-label">Lokasi Fisik Terkini</label>
                <input type="text" class="form-control" id="lokasiFisik" name="lokasiFisik" value="<%= item.lokasiFisik %>" required>
                 <small class="form-text text-muted">Lokasi awal: <%= item.lokasiFisik_awal %></small>
            </div>
            <div class="col-md-4 mb-3">
                <label for="noPintuLokasi" class="form-label">No. Pintu/Detail Lokasi Terkini</label>
                <input type="text" class="form-control" id="noPintuLokasi" name="noPintuLokasi" value="<%= item.noPintuLokasi || '' %>" placeholder="Contoh: P.01 / Lemari B">
                 <small class="form-text text-muted">No. Pintu awal: <%= item.noPintuLokasi_awal || 'N/A' %></small>
            </div>
        </div>

        <div class="mb-3">
            <label for="statusKondisi" class="form-label">Status Kondisi Terkini</label>
            <select class="form-select" id="statusKondisi" name="statusKondisi" required>
                <% options.statusKondisi.forEach(s => { %>
                    <option value="<%= s %>" <%= item.statusKondisi === s ? 'selected' : '' %>><%= s %></option>
                <% }) %>
            </select>
             <small class="form-text text-muted">Kondisi awal: <%= item.statusKondisi_awal %></small>
        </div>

        <fieldset class="border p-3 mt-4 rounded">
            <legend class="float-none w-auto px-2 h6">Informasi Penghapusan Aset</legend>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="statusPenghapusan" class="form-label">Status Penghapusan</label>
                    <select class="form-select" id="statusPenghapusan" name="statusPenghapusan">
                        <% options.statusPenghapusan.forEach(sp => { %>
                            <option value="<%= sp %>" <%= item.statusPenghapusan === sp ? 'selected' : '' %>><%= sp %></option>
                        <% }) %>
                    </select>
                </div>
                 <div class="col-md-6 mb-3">
                    <label for="tanggalPenghapusan" class="form-label">Tanggal Penghapusan</label>
                    <input type="date" class="form-control" id="tanggalPenghapusan" name="tanggalPenghapusan" value="<%= item.tanggalPenghapusanFormatted %>">
                </div>
            </div>
            <div class="mb-3">
                <label for="dasarPenghapusan" class="form-label">Dasar Penghapusan (No. Surat, dll)</label>
                <input type="text" class="form-control" id="dasarPenghapusan" name="dasarPenghapusan" value="<%= item.dasarPenghapusan || '' %>">
            </div>
            <small class="form-text text-muted">Isi bagian ini hanya jika status penghapusan BUKAN 'Masih Digunakan'. Tanggal Penghapusan wajib diisi jika status diubah.</small>
        </fieldset>

        <div class="d-flex gap-2 mt-4">
            <button type="submit" class="btn btn-primary"><i class="bi bi-save-fill"></i> Update Barang</button>
            <a href="/" class="btn btn-secondary">Batal</a>
        </div>
    </form>
</div>

<%- include('partials/footer') %>