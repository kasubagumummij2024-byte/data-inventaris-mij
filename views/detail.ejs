<%- include('partials/header') %>

<div class="card shadow-sm">
    <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
        <h2 class="h4 mb-0">Detail Inventaris: <%= item.nomorInventaris %></h2>
        <!-- Tombol Edit hanya muncul jika user login -->
        <% if (user) { %>
            <a href="/edit/<%= item.id %>" class="btn btn-outline-light btn-sm"><i class="bi bi-pencil-square"></i> Edit</a>
        <% } %>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-8">
                <h3 class="card-title"><%= item.namaBarang %></h3>
                <table class="table table-bordered table-striped">
                    <tbody>
                        <tr>
                            <th scope="row" style="width: 30%;">Nomor Inventaris</th>
                            <td><strong><%= item.nomorInventaris %></strong></td>
                        </tr>
                        <tr>
                            <th scope="row">Nama Barang</th>
                            <td><%= item.namaBarang %></td>
                        </tr>
                        <tr>
                            <th scope="row">Warna</th>
                            <td><%= item.warna || 'N/A' %></td>
                        </tr>
                        <tr>
                            <th scope="row">Kategori</th>
                            <td><%= item.kategori %> (<%= item.subKategori %>)</td>
                        </tr>
                        <tr>
                            <th scope="row">Sumber Anggaran</th>
                            <td><span class="badge bg-info text-dark"><%= item.sumberAnggaran || 'N/A' %></span></td>
                        </tr>
                        <tr>
                            <th scope="row">Tahun Perolehan</th>
                            <td><%= item.tahunPerolehan || 'N/A' %></td>
                        </tr>
                        <tr>
                            <th scope="row">Nilai Perolehan</th>
                            <td><%= new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(item.nilaiPerolehan || 0) %></td>
                        </tr>
                        <tr><td colspan="2" class="bg-light fw-bold text-center">Riwayat Kondisi & Lokasi</td></tr>
                        <tr>
                            <th scope="row">Kondisi Awal</th>
                            <td><span class="badge bg-secondary"><%= item.statusKondisi_awal || 'N/A' %></span></td>
                        </tr>
                        <tr>
                            <th scope="row">Kondisi Terkini</th>
                            <td>
                                <% if(item.statusKondisi === 'Baik') { %> <span class="badge bg-success"><%= item.statusKondisi %></span>
                                <% } else if (item.statusKondisi && item.statusKondisi.includes('Perbaikan')) { %> <span class="badge bg-warning text-dark"><%= item.statusKondisi %></span>
                                <% } else if (item.statusKondisi) { %> <span class="badge bg-danger"><%= item.statusKondisi %></span>
                                <% } else { %> N/A <% } %>
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">Lokasi Awal</th>
                            <td><%= item.lokasiFisik_awal || 'N/A' %></td>
                        </tr>
                        <tr>
                            <th scope="row">Lokasi Terkini</th>
                            <td><%= item.lokasiFisik %></td>
                        </tr>
                         <tr><td colspan="2" class="bg-light fw-bold text-center">Riwayat Jumlah</td></tr>
                         <tr>
                            <th scope="row">Jumlah Awal</th>
                            <td><%= item.jumlah_awal || 'N/A' %> <%= item.satuan %></td>
                        </tr>
                        <tr>
                            <th scope="row">Jumlah Terkini</th>
                            <td><%= item.jumlah %> <%= item.satuan %></td>
                        </tr>
                        <tr><td colspan="2" class="bg-light fw-bold text-center">Riwayat Pencatatan</td></tr>
                        <tr>
                            <th scope="row">Diinput oleh</th>
                            <td><%= item.createdBy %> <br><small class="text-muted"><%= item.createdAt.toDate().toLocaleString('id-ID', { dateStyle: 'long', timeStyle: 'short'}) %></small></td>
                        </tr>
                        <tr>
                            <th scope="row">Update Terakhir oleh</th>
                            <td><%= item.updatedBy && item.updatedAt.toDate().getTime() !== item.createdAt.toDate().getTime() ? `${item.updatedBy} <br><small class="text-muted">${item.updatedAt.toDate().toLocaleString('id-ID', { dateStyle: 'long', timeStyle: 'short'})}</small>` : '<span class="text-muted">Belum ada update</span>' %></td>
                        </tr>
                        
                        <!-- Informasi Penghapusan (jika ada) -->
                        <% if (item.statusPenghapusan && item.statusPenghapusan !== 'Masih Digunakan') { %>
                        <tr><td colspan="2" class="bg-danger fw-bold text-white text-center">Informasi Penghapusan Aset</td></tr>
                        <tr class="table-danger">
                            <th scope="row">Status</th>
                            <td><strong><%= item.statusPenghapusan %></strong></td>
                        </tr>
                        <tr class="table-danger">
                            <th scope="row">Dasar Penghapusan</th>
                            <td><%= item.dasarPenghapusan || 'N/A' %></td>
                        </tr>
                        <tr class="table-danger">
                            <th scope="row">Tanggal Penghapusan</th>
                            <td><%= item.tanggalPenghapusan ? item.tanggalPenghapusan.toDate().toLocaleDateString('id-ID', { day: '2-digit', month: 'long', year: 'numeric'}) : 'N/A' %></td>
                        </tr>
                        <% } %>

                    </tbody>
                </table>
            </div>
            <div class="col-md-4 text-center">
                <h5>Scan QR Code Aset</h5>
                <img src="<%= qrCodeDataUrl %>" alt="QR Code" class="img-fluid border rounded p-2 mb-2">
                <a href="<%= qrCodeDataUrl %>" download="QR_<%= item.nomorInventaris.replace(/\//g, '-') %>.png" class="btn btn-success btn-sm">
                    <i class="bi bi-download"></i> Unduh QR Code
                </a>
            </div>
        </div>
    </div>
</div>
<a href="/" class="btn btn-secondary mt-3"><i class="bi bi-arrow-left-circle"></i> Kembali ke Daftar</a>

<%- include('partials/footer') %>
